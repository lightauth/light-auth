{"version":3,"file":"index.js","sources":["../../../../light-auth-core/dist/client/index.mjs","../../../../light-auth-express/dist/client/index.mjs","../../../lib/auth-client.ts","../../../lib/login.ts"],"sourcesContent":["/*! @light-auth/core v0.2.6 2025-06-04 */\n'use client';\n\nconst DEFAULT_BASE_PATH = \"/api/auth\";\n\n/** Resolves the basePath, defaults to \"/api/default\" if not provided or falsy */\nfunction resolveBasePath(basePath, env) {\n    let resolvedBasePath = basePath || env?.[\"LIGHT_AUTH_BASE_PATH\"] || DEFAULT_BASE_PATH;\n    if (!resolvedBasePath.startsWith(\"/\"))\n        resolvedBasePath = `/${resolvedBasePath}`;\n    // Ensure the base path does not end with \"/\"\n    if (resolvedBasePath.endsWith(\"/\"))\n        resolvedBasePath = resolvedBasePath.slice(0, -1);\n    // Ensure the base path does not contain double slashes\n    if (resolvedBasePath.includes(\"//\"))\n        resolvedBasePath = resolvedBasePath.replace(/\\/\\//g, \"/\");\n    return resolvedBasePath;\n}\n\n/**\n * this function is used to make a request to the light auth server\n * it can be done from the server side or the client side\n *\n * it will use the router to get the url and the headers (if server side)\n */\nasync function internalFetch(args) {\n    const { config, body, method = \"GET\", headers } = args;\n    const { router } = config;\n    const env = config.env;\n    const basePath = resolveBasePath(config.basePath, env);\n    // check if we are on the server side or client side\n    // if we are on the server side, we need to use the router to get the url and headers\n    // if we are on the client side, we can use the window object to get the url and headers\n    const isServerSide = typeof window === \"undefined\";\n    const bodyBytes = body ? new TextEncoder().encode(body.toString()) : undefined;\n    // get all the headers from the request\n    let requestHeaders = headers ?? null;\n    if (router && isServerSide)\n        requestHeaders = await router.getHeaders({ env, basePath, ...args });\n    // get the full url from the router if available\n    let url = args.endpoint;\n    if (router && isServerSide)\n        url = await router.getUrl({ env, basePath, ...args });\n    const request = bodyBytes\n        ? new Request(url.toString(), { method: method, headers: requestHeaders ?? new Headers(), body: bodyBytes })\n        : new Request(url.toString(), { method: method, headers: requestHeaders ?? new Headers() });\n    let response = null;\n    try {\n        response = await fetch(request);\n    }\n    catch (error) {\n        console.error(\"Error:\", error);\n        throw new Error(`light-auth: Request failed with error ${error}`);\n    }\n    if (!response || !response.ok) {\n        throw new Error(`light-auth: Request failed with status ${response?.status}`);\n    }\n    const contentType = response.headers.get(\"Content-Type\");\n    if (contentType && contentType.includes(\"application/x-www-form-urlencoded\")) {\n        const formResponse = await response.text();\n        const formData = new URLSearchParams(formResponse);\n        const result = {};\n        for (const [key, value] of formData.entries()) {\n            result[key] = value;\n        }\n        return result;\n    }\n    if (contentType && (contentType.includes(\"application/json\") || contentType.includes(\"text/plain\"))) {\n        const jsonResponse = await response.json();\n        return jsonResponse;\n    }\n    if (contentType && contentType.includes(\"application/octet-stream\")) {\n        const blobResponse = await response.blob();\n        return blobResponse;\n    }\n    return null;\n}\n\nasync function getCsrfToken(args) {\n    const isServerSide = typeof window === \"undefined\";\n    if (isServerSide)\n        return;\n    const { config } = args;\n    // Get a csrf token from the server\n    const endpoint = `${config.basePath}/csrf`;\n    const csrfToken = await internalFetch({ endpoint, method: \"POST\", ...args });\n    if (!csrfToken)\n        throw new Error(\"light-auth: Failed to get csrf token\");\n    // Check if the csrf token cookie, called light_auth_csrf_token exist\n    const csrfTokenCookie = document.cookie.split(\"; \").find((row) => row.startsWith(\"light_auth_csrf_token=\"));\n    if (csrfTokenCookie)\n        window.document.cookie = `light_auth_csrf_token=; path=/; max-age=0;`;\n    // Set the csrf token in the cookie store\n    window.document.cookie = `light_auth_csrf_token=${csrfToken.csrfTokenHash}.${csrfToken.csrfToken}; path=/; secure=true}`;\n}\n\nfunction createSigninClientFunction(config) {\n    return async (args = {}) => {\n        const { providerName, callbackUrl = \"/\" } = args;\n        // check if we are on the server side or client side\n        const isServerSide = typeof window === \"undefined\";\n        if (isServerSide)\n            throw new Error(\"light-auth-client: signin function should not be called on the server side\");\n        // Get a csrf token from the server and set it in the cookie store\n        await getCsrfToken({ config, ...args });\n        window.location.href = `${config.basePath}/login/${providerName}?callbackUrl=${encodeURIComponent(callbackUrl)}`;\n    };\n}\nfunction createSignoutClientFunction(config) {\n    return async (args = {}) => {\n        const { revokeToken = true, callbackUrl = \"/\" } = args;\n        const isServerSide = typeof window === \"undefined\";\n        if (isServerSide)\n            throw new Error(\"light-auth-client: signout function should not be called on the server side\");\n        // Get a csrf token from the server and set it in the cookie store\n        await getCsrfToken({ config, ...args });\n        window.location.href = `${config.basePath}/logout?revokeToken=${revokeToken}&callbackUrl=${encodeURIComponent(callbackUrl)}`;\n    };\n}\nfunction createFetchSessionClientFunction(config) {\n    return async (args) => {\n        try {\n            const isServerSide = typeof window === \"undefined\";\n            if (isServerSide)\n                throw new Error(\"light-auth-client: fetchSession function should not be called on the server side\");\n            // get the session from the server using the api endpoint\n            const session = await internalFetch({ config, method: \"POST\", endpoint: `${config.basePath}/session`, ...args });\n            return session ?? null;\n        }\n        catch (error) {\n            console.error(\"Error:\", error);\n            return null;\n        }\n    };\n}\nfunction createSetSessionClientFunction(config) {\n    return async (session, args) => {\n        try {\n            const isServerSide = typeof window === \"undefined\";\n            if (isServerSide)\n                throw new Error(\"light-auth-client: setSession function should not be called on the server side\");\n            // get the session from the server using the api endpoint\n            const updatedSession = await internalFetch({\n                config,\n                method: \"POST\",\n                body: JSON.stringify(session),\n                endpoint: `${config.basePath}/set_session`,\n                ...args,\n            });\n            return updatedSession ?? null;\n        }\n        catch (error) {\n            console.error(\"Error:\", error);\n            return null;\n        }\n    };\n}\nfunction createFetchUserClientFunction(config) {\n    return async (args) => {\n        try {\n            const isServerSide = typeof window === \"undefined\";\n            if (isServerSide)\n                throw new Error(\"light-auth-client: getUser function should not be called on the server side\");\n            const endpoint = args?.userId ? `${config.basePath}/user/${args.userId}` : `${config.basePath}/user`;\n            // get the user from the user adapter\n            const user = await internalFetch({ config, method: \"POST\", endpoint, ...args });\n            if (!user)\n                return null;\n            return user;\n        }\n        catch (error) {\n            console.error(\"light-auth: Error in createLightAuthUserFunction:\", error);\n            return null;\n        }\n    };\n}\nfunction createSetUserClientFunction(config) {\n    return async (user, args) => {\n        try {\n            const isServerSide = typeof window === \"undefined\";\n            if (isServerSide)\n                throw new Error(\"light-auth-client: setUser function should not be called on the server side\");\n            const updatedUser = await internalFetch({\n                config,\n                method: \"POST\",\n                body: JSON.stringify(user),\n                endpoint: `${config.basePath}/set_user`,\n                ...args,\n            });\n            return updatedUser ?? null;\n        }\n        catch (error) {\n            console.error(\"Error:\", error);\n            return null;\n        }\n    };\n}\n\nexport { DEFAULT_BASE_PATH, createFetchSessionClientFunction, createFetchUserClientFunction, createSetSessionClientFunction, createSetUserClientFunction, createSigninClientFunction, createSignoutClientFunction, resolveBasePath };\n//# sourceMappingURL=index.mjs.map\n","/*! @light-auth/express v0.2.6 2025-06-04 */\n'use client';\n\nimport { createSigninClientFunction, createSignoutClientFunction, resolveBasePath, createSetUserClientFunction, createFetchUserClientFunction, createSetSessionClientFunction, createFetchSessionClientFunction } from '@light-auth/core/client';\n\nconst createGetAuthSession = (config) => {\n    const getSession = createFetchSessionClientFunction(config);\n    return async () => await getSession();\n};\nconst createSetAuthSession = (config) => {\n    const setSession = createSetSessionClientFunction(config);\n    return async (session) => await setSession(session, config);\n};\nconst createGetUser = (config) => {\n    const getUser = createFetchUserClientFunction(config);\n    return async () => await getUser();\n};\nconst createSetUser = (config) => {\n    const setUser = createSetUserClientFunction(config);\n    return async (user) => await setUser(user, config);\n};\nfunction createSignin(config) {\n    const signInFunction = createSigninClientFunction(config);\n    return async (providerName, callbackUrl = \"/\") => await signInFunction({ providerName, callbackUrl });\n}\nfunction createSignout(config) {\n    const signOutFunction = createSignoutClientFunction(config);\n    return async (revokeToken = false, callbackUrl = \"/\") => await signOutFunction({ revokeToken, callbackUrl });\n}\nfunction CreateLightAuthClient(config = {}) {\n    // @ts-ignore\n    config.env = config.env || import.meta;\n    config.basePath = resolveBasePath(config.basePath, config.env);\n    return {\n        basePath: config.basePath,\n        getAuthSession: createGetAuthSession(config),\n        setAuthSession: createSetAuthSession(config),\n        getUser: createGetUser(config),\n        setUser: createSetUser(config),\n        signIn: createSignin(config),\n        signOut: createSignout(config),\n    };\n}\n\nexport { CreateLightAuthClient, createSignin, createSignout };\n//# sourceMappingURL=index.mjs.map\n",null,null],"names":["DEFAULT_BASE_PATH","createGetAuthSession","config","getSession","createFetchSessionClientFunction","createSetAuthSession","setSession","createSetSessionClientFunction","session","createGetUser","getUser","createFetchUserClientFunction","createSetUser","setUser","createSetUserClientFunction","user","createSignin","signInFunction","createSigninClientFunction","providerName","callbackUrl","createSignout","signOutFunction","createSignoutClientFunction","revokeToken","CreateLightAuthClient","env","import","basePath","resolveBasePath","getAuthSession","setAuthSession","signIn","signOut"],"mappings":"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"}